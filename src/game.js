const params=new URLSearchParams(window.location.search);null==localStorage.getItem("trapped_game_intro")&&localStorage.setItem("trapped_game_intro",!1),null==localStorage.getItem("trapped_game_sound")&&localStorage.setItem("trapped_game_sound",!0);let Game={width:320,height:480,scenes:null,permission:!1,timestamp:0,hits:[],shapes:[],skip_intro:"true"===localStorage.getItem("trapped_game_intro"),sound:"true"===localStorage.getItem("trapped_game_sound"),song:null,bug:null,over:!1,godmode:!!params.get("godmode")};const levels={Intro:Intro,Title:Title,HomeMessages:HomeMessages,Messages:Messages,HomeTwitter:HomeTwitter,Twitter:Twitter,HomeMusic:HomeMusic,Music:Music,HomeMaps:HomeMaps,Maps:Maps,HomeSnap:HomeSnap,Snap:Snap,Outro:Outro};let text_bold,text_regular,dummy,intro,tutorial,theme,dead,home,messages,twitter,music,maps,snap,finale,outro;const requestAccess=()=>{DeviceMotionEvent.requestPermission().then((e=>{"granted"==e?(Game.permission=!0,document.getElementById("permission").hidden=Game.permission):Game.permission=!1})).catch(console.error)};function preload(){angleMode(DEGREES),soundFormats("mp3"),tutorial=loadImage("/assets/tutorial.gif"),text_bold=loadFont("./assets/Outfit-ExtraBold.ttf"),text_regular=loadFont("./assets/Outfit-Light.ttf"),dummy=loadSound("./assets/dummy"),theme=loadSound("./assets/theme"),dead=loadSound("./assets/dead"),home_twitter=loadSound("./assets/home_twitter"),home_messages=loadSound("./assets/home_messages"),home_music=loadSound("./assets/home_music"),home_maps=loadSound("./assets/home_maps"),home_snap=loadSound("./assets/home_maps"),messages=loadSound("./assets/messages"),twitter=loadSound("./assets/twitter"),music=loadSound("./assets/music"),maps=loadSound("./assets/maps"),snap=loadSound("./assets/snap"),finale=loadSound("./assets/finale"),Game.skip_intro||(intro=createVideo("./assets/intro.mov"),intro.elt.setAttribute("playsinline",!0),intro.elt.hidden=!0),outro=createVideo("./assets/outro.mov"),outro.elt.setAttribute("playsinline",!0),outro.elt.hidden=!0}function setup(){for(level in"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().catch((e=>{throw document.getElementById("permission").hidden=!1,document.getElementById("request").addEventListener("click",requestAccess),e})).then((()=>{Game.permission=!0,document.getElementById("permission").hidden=Game.permission})):Game.permission=!0,Game.scenes=new SceneManager,levels)Game.scenes.addScene(levels[level]);createCanvas(Game.width,Game.height),Game.bug=new Bug(Game.width/2,Game.height/2),Game.scenes.showScene(Intro)}function draw(){Game.permission&&(vX=constrain(rotationY,-60,60),vY=constrain(rotationX,-60,60),vX=constrain(abs(vX)-2,0,60)*(vX<0?-1:1),vY=constrain(abs(vY)-2,0,60)*(vY<0?-1:1),Game.bug.update(vX/3,vY/3),Game.godmode||Game.hits.forEach((e=>{Game.over||e&&(Game.timestamp=millis(),Game.over=!0,Game.sound&&(Game.song.stop(),Game.song=dead,Game.song.setVolume(1),Game.song.play()))})),Game.over&&(Game.shapes.forEach((e=>{e.q=[],e.velocity_x+=e.acceleration_x,e.velocity_y+=e.acceleration_y,e.x+=e.velocity_x,e.y+=e.velocity_y})),millis()-Game.timestamp>2500&&(Game.hits=[],Game.shapes=[],Game.over=!1,Game.timestamp=millis(),Game.scenes.scene.oScene.reset(),Game.scenes.showScene(Title))),Game.scenes.draw(),Game.bug.draw())}function touchStarted(){Game.scenes.handleEvent("touchStarted")}function touchMoved(){Game.scenes.handleEvent("touchMoved")}function touchEnded(){Game.scenes.handleEvent("touchEnded")}
